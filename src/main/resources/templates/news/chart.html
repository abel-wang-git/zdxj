<html xmlns:th="http://www.thymeleaf.org" style="height: 100%">
<head >
    <div th:include="fragment/head :: head"></div>
</head>
<body>
   <div id="zheXian" style="height:300px; text-align-all: center;"></div>
   <div style="height:20px;"></div>

   <div id="circle" style="height:550px;text-align-all: center"></div>
   <div style="height:20px;"></div>

   <div id="zhuX" style="height:550px; text-align-all: center;"></div>
   <div style="height:20px;"></div>

   <div id="zheXian1" style="height:400px; text-align-all: center;"></div>
   <div style="height:20px;"></div>

   <script th:inline="javascript">
       //接收后台传过来的值
          /*<![CDATA[*/
          var charts = [[${charts}]];
          var x = new Array();
          var y = new Array();
          for(var i=0;i<charts.length;i++){
              x[i]=charts[i][0];
              y[i]=charts[i][1];
          }

       // 基于准备好的dom，初始化echarts实例
       //所有信息中每个月的舆情信息量折线图
       var myChart = echarts.init(document.getElementById('zheXian'));
       // 指定图表的配置项和数据
       var option = {
           title: {
               text: '情报每月统计图',
               x:'center'
           },
           tooltip: {},
           toolbox:{
               show:true,
               feature:{
                   saveAsImage:{
                       show:true,
                       pixelRatio:2
                   }
               }
           },
           legend: {
               data:['信息条数'],
               left: 'left',
           },
           xAxis: {
               data:x
           },
           yAxis: {},
           series: [{
               name: '信息条数',
               type: 'line',
               data: y
           }]
       };
       // 使用刚指定的配置项和数据显示图表。
       myChart.setOption(option);
   //    var picBase64Info = myChart.getConnectedDataURL("png");
   //-------------------------------------------------------------------------------------

       function exportImage(){
           var data = encodeURIComponent(myChart.getDataURL("png"));
           alert(data);
           var xmlhttp;
           if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
               xmlhttp = new XMLHttpRequest();
           } else { // code for IE6, IE5
               xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
           }
           xmlhttp.open("GET","http://localhost:8080/news/word",true);
           xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
           xmlhttp.onreadystateschange = function() {
               if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                   alert("保存成功");
               }
           }
           xmlhttp.send("a=" + data);
       }
       setTimeout(exportImage(), 2000);

   //--------------------------------------------------------------------------------
       var charts1 = [[${charts1}]];
       var source = new Array();
       var data = new Array();
       var data1 = new Array();
       for (var i = 0; i < charts1.length; i++) {
           source[i] = charts1[i][0];
           data[i] = {value: charts1[i][1], name: charts1[i][0]};
           data1[i] = charts1[i][1];
       }

       //饼状图
       var myChart1 = echarts.init(document.getElementById('circle'));
       option1 = {
           title: {
               text: '信息来源',
               subtext: '网站名称',
               x: 'center'
           },
           tooltip: {
               trigger: 'item',
               formatter: "{a} <br/>{b} : {c} ({d}%)"
           },
           toolbox:{
               show:true,
               feature:{
                   saveAsImage:{
                       show:true,
                       pixelRatio:2
                   }
               }
           },
           series: [
               {
                   name: '访问来源',
                   type: 'pie',
                   radius: '55%',
                   center: ['50%', '60%'],
                   data: data,
                   itemStyle: {
                       emphasis: {
                           shadowBlur: 10,
                           shadowOffsetX: 0,
                           shadowColor: 'rgba(0, 0, 0, 0.5)'
                       }
                   }
               }
           ]
       };
       myChart1.setOption(option1);

       //柱形图
       var myChart2 = echarts.init(document.getElementById('zhuX'));
       option2 = {
           title: {
               text: '核心媒体排行',
               x:'center'
           },
           color: ['#3398DB'],
           tooltip : {
               trigger: 'axis',
               axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                   type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
               }
           },
           toolbox:{
               show:true,
               feature:{
                   saveAsImage:{
                       show:true,
                       pixelRatio:2
                   }
               }
           },
           grid: {
               left: '3%',
               right: '4%',
               bottom: '3%',
               containLabel: true
           },
           xAxis : [
               {
                   type : 'category',
                   data :source,
                   axisTick: {
                       alignWithLabel: true
                   },
                   axisLabel: {
                       interval:0,
                       rotate:40
                   }
               }
           ],
           yAxis : [
               {
                   type : 'value'
               }
           ],
           series : [
               {
                   name:'信息量',
                   type:'bar',
                   barWidth: '60%',
                   data:data1
               }
           ]
       };
       myChart2.setOption(option2);

       //媒体、网民热度折线图
       var myChart3 = echarts.init(document.getElementById('zheXian1'));
       option3 = {
           title: {
               text: '戒毒话题媒体、网民关注趋势'
           },
           tooltip: {
               trigger: 'axis'
           },
           toolbox:{
               show:true,
               feature:{
                   saveAsImage:{
                       show:true,
                       pixelRatio:2
                   }
               }
           },
           legend: {
               data:['媒体','网民']
           },
           grid: {
               left: '3%',
               right: '4%',
               bottom: '3%',
               containLabel: true
           },
           toolbox: {
               feature: {
                   saveAsImage: {}
               }
           },
           xAxis: {
               type: 'category',
               boundaryGap: false,
               data: ['周一','周二','周三','周四','周五','周六','周日']
           },
           yAxis: {
               type: 'value'
           },
           series: [
               {
                   name:'媒体',
                   type:'line',
                   stack: '总量',
                   data:[120, 132, 101, 134, 90, 230, 210]
               },
               {
                   name:'网民',
                   type:'line',
                   stack: '总量',
                   data:[220, 182, 191, 234, 290, 330, 310]
               }
           ]
       };
       myChart3.setOption(option3);
       /*]]>*/
   </script>

</body>
</html>